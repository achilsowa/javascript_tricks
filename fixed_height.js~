app.directive('fixedHeight', [function (){
    return {
        restrict: 'A',
        link: function ($scope, $element, attrs) {
	    if ($(window).width() < 768) return;
            var adjust = function () {

                var w_h = $(window).height();
                var top = $element.offset().top;
                var final_height = w_h - top - 20;

                if (attrs.$attr['chapter-bottom']) final_height -= 60;


                var real_height = $element.get(0).scrollHeight;
                if (attrs.$attr['restrict']  && real_height && real_height < final_height) final_height = real_height;
                final_height -= 50;
                $element.height(final_height);
                $element.customScrollbar({skin:'default-skin'});

            };


            $(window).bind('resize', adjust);
            setTimeout(function () {
                $(window).trigger('resize');
            }, 1);

            $element.on('$destroy', function (){
                $(window).unbind('resize', adjust);
            });
        }
    };
}]);
