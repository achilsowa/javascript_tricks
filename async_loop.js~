var async_loop = function (fundamental){

    var loop = function (i, length, after){
	if (i >= length) {
	    if (!after) return;
	    if (after.args && after.func) 
		after.func.apply(after.this, after.args);
	    return;
	}
	fundamental(loop, i, length, after );
    };

    return loop;
};


var repeater =  async_loop(function (loop, i, length, after) {
    var usr = data.users[Math.floor(Math.random()*
				    data.MAX_USERS)%data.MAX_USERS];
    var url = URL + '/social/follow/'+usr._id;
    agent.post(url).send().end(function (){
	loop(i+1, length, after);
    });	
});




var test = async_loop(function (loop, i, length, after) {
    var k = (Math.floor(Math.random()*10)%5)+1;
    setTimeout(function() {
	console.log(i,k);
	loop(i+1, length, after);}, k*1000);
    return;
});

module.exports = test;
